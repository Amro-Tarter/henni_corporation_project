// src/pages/FormsPage.jsx
import React, { useState } from 'react'; // Removed useRef, as it's not strictly needed for docx simple text generation
import DashboardLayout from "../../components/dashboard/DashboardLayout";
import { FileText, Download } from 'lucide-react';
import { saveAs } from 'file-saver';
import { Document, Paragraph, TextRun, Packer, AlignmentType } from 'docx'; // All necessary imports for DOCX

const formsData = [
  {
    id: 'form1',
    title: 'טופס קליטה לעמותת תלגלות את האור',
    content: `טופס קליטה לעמותת תלגלות את האור
פרטי הילד/ה והמשפחה
פרטים אישיים
שם פרטי: _________________ שם משפחה: _________________

תאריך לידה: //______ גיל: _____ מין: □ זכר □ נקבה

כתובת מגורים: _________________________________________________

עיר: _____________ מיקוד: _________

בית ספר: _________________________ כיתה: _____

פרטי הורים/אפוטרופוס
שם ההורה/אפוטרופוס הראשי: _____________________________

קרבת משפחה: □ אם □ אב □ סבא/סבתא □ דוד/דודה □ אפוטרופוס אחר: _______

טלפון נייד: _____________ טלפון בית: _____________

אימייל: _________________________________

מקצוע: _________________ מקום עבודה: _________________

שם הורה שני (אם רלוונטי): _____________________________

טלפון נייד: _____________ אימייל: _________________

מצב משפחתי ורקע
מצב זוגי של ההורים: □ נשואים □ גרושים □ אלמן/ה □ רווקים □ אחר: _______

מספר ילדים במשפחה: _____ מיקום הילד/ה בין האחים: _____

שפות הדיבור בבית: _____________________________

מצב כלכלי משפחתי: □ מעל הממוצע □ ממוצע □ מתחת לממוצע □ קשיים כלכליים

פרטים רפואיים ופיזיים
האם יש לילד/ה בעיות בריאותיות כרוניות? □ כן □ לא

אם כן, פרטו: _______________________________________________

האם הילד/ה נוטל/ת תרופות באופן קבוע? □ כן □ לא

אם כן, אילו תרופות ולמה: ___________________________________

האם יש אלרגיות? □ כן □ לא

אם כן, פרטו: _______________________________________________

האם יש מוגבלויות פיזיות או קשיי למידה מאובחנים? □ כן □ לא

אם כן, פרטו: _______________________________________________

רקע רגשי ואישיותי
תארו את אישיות הילד/ה: (ביישן/ית, חברותי/ת, אנרגטי/ת, רגיש/ה וכו')

האם הילד/ה מטופל/ת אצל פסיכולוג/עובד סוציאלי/יועץ? □ כן □ לא

אם כן, פרטו על הטיפול והסיבה: ________________________________

האם היו אירועים משמעותיים בחיי הילד/ה? (מחלה, מוות במשפחה, גירושין, מעבר דירה וכו')

עניין באמנות וכישרונות
באילו תחומי אמנות הילד/ה מגלה עניין? (ניתן לסמן כמה)

□ תיאטרון/משחק □ מוזיקה/שירה □ מחול/תנועה □ אמנות חזותית □ כתיבה יוצרת

האם הילד/ה למד/ה בעבר תחומי אמנות? □ כן □ לא

אם כן, פרטו: _______________________________________________

תארו כישרונות מיוחדים של הילד/ה: ____________________________

מה הילד/ה הכי אוהב/ת לעשות בזמן הפנוי? ________________________

מטרות וציפיות
מה הסיבה להצטרפות לעמותה? (ניתן לסמן כמה)

□ פיתוח יכולות אמנותיות □ חיזוק ביטחון עצמי □ פיתוח כישורים חברתיים □ העשרה תרבותית □ מתן מסגרת תומכת □ אחר: ________________

מה הציפיות שלכם מהעמותה?

האם יש משהו מיוחד שחשוב לנו לדעת על הילד/ה?

פרטים נוספים
איך שמעתם על העמותה?

□ המלצה מחבר/בן משפחה □ רשתות חברתיות □ בית ספר □ אתר אינטרנט □ אחר: _______

האם תוכלו להגיע לפעילויות באופן קבוע? □ כן □ לא בטוח □ לא

האם יש לכם דרישות מיוחדות להסעות? □ כן □ לא

אם כן, פרטו: _______________________________________________

הסכמות והצהרות
□ אני מסכים/ה שהעמותה תיצור קשר עם גורמים רלוונטיים (בית ספר, מטפלים וכו') במידת הצורך

□ אני מסכים/ה לצילום הילד/ה לצרכי תיעוד ופרסום של העמותה (ללא פרסום שמות)

□ אני מתחייב/ת להודיע על שינויים במצב הבריאותי או האישי של הילד/ה

□ אני מאשר/ת שכל המידע שמסרתי נכון ומדויק

שם חותם של ההורה/אפוטרופוס: _____________________________

חתימה: _____________ תאריך: //______

רק למילוי צוות העמותה:

תאריך קבלת הטופס: //______ מי קיבל: _____________

הערות צוות: _______________________________________________

אושר לקבלה: □ כן □ לא תאריך תחילת פעילות: //______
`,
    fileName: 'טופס_קליטה_לעמותת_לגלות_את_האור.docx' // Changed to .docx
  },
  {
    id: 'form2',
    title: 'שאלון הכנה למנטוריות',
    content: `שאלון הכנה למנטוריות
עמותת תלגלות את האור
שם הילד/ה: _________________ תאריך: //______

הורים יקרים,

כדי שהמנטור יוכל להכין מפגש מותאם ומועיל עבורכם, אנא מלאו את השאלון הקצר הזה ושלחו אותו 2-3 ימים לפני המפגש.

1. מצב הילד/ה השבועות האחרונים
איך הילד/ה מרגיש/ה לאחרונה? □ מאושר/ת ואנרגטי/ת □ רגוע/ה ומאוזן/ת □ קצת עצוב/ה או מתוח/ה □ משתנה הרבה

שינויים שהבחנתם בהם בזמן האחרון: (התנהגות, מצב רוח, הרגלי שינה, תיאבון וכו')

האם קרה משהו מיוחד בבית/בבית ספר/בחיים שלו/ה?

2. הקשר עם העמותה
איך הילד/ה מספר/ת על הפעילויות בעמותה? □ מתלהב/ת ומספר/ת הרבה □ אוהב/ת אבל לא מספר/ת הרבה □ מתלונן/ת לפעמים □ לא אוהב/ת לדבר על זה

דברים שהילד/ה הכי אוהב/ת בעמותה:

דברים שגורמים לו/ה קושי או מתח:

3. מה אתם רוצים לדון עליו
בחרו עד 3 נושאים שהכי חשובים לכם לדבר עליהם: (סמנו ✓)

□ התקדמות הילד/ה בתחום האמנותי □ התפתחות חברתית ויחסים עם ילדים אחרים □ בניית ביטחון עצמי □ התמודדות עם קשיים או אתגרים □ התנהגות של הילד/ה בבית □ עבודת שיתוף עם בית הספר □ יעדים לתקופה הקרובה □ דרכים שאתם יכולים לעזור בבית □ אחר: ________________________________

השאלה הכי חשובה שרציתם לשאול:

4. האווירה בבית
איך הילד/ה מתנהג/ת בבית השבועות האחרונים? □ שיתופי/ת ונעים/ה □ רגיל/ה כמו תמיד □ קצת עצבני/ת או עקשן/ית □ סגור/ה ושקט/ה □ משתנה לפי היום

האם יש דברים שגורמים במיוחד לעימותים או קושי?

דברים שמשמחים את הילד/ה בזמן האחרון:

5. בקשות מיוחדות
האם יש נושא רגיש שחשוב שהמנטור ידע עליו? (גירושין, מחלה במשפחה, קשיים כלכליים, בעיות בבית ספר וכו')

איך אתם מעדיפים שהמנטור יגיש לילד/ה עצות או ביקורת? □ ישירות וברור □ בעדינות ובהדרגה □ דרך סיפורים ודוגמאות □ בהומור

האם יש דברים שהילד/ה לא אוהב/ת לשמוע או שגורמים לו/ה לסגירות?

6. מטרות לשיחה
מה אתם הכי מקווים לקבל מהשיחה הזאת? □ הבנת המצב הנוכחי של הילד/ה □ כלים מעשיים לטיפול בבעיות □ עידוד וחיזוק שאתם בדרך הנכונה □ יעדים ברורים לתקופה הקרובה □ הכנה לאירוע או שינוי מתוכנן □ אחר: ________________________________

בסיום השיחה, איך תדעו שהיא הייתה מוצלחת עבורכם?

7. פרטים מעשיים
עדיפות זמן לשיחה: □ בוקר □ צהריים □ אחר הצהריים □ ערב

איך מעדיפים לקיים את השיחה? □ פגישה פיזית □ זום/שיחת וידאו □ שיחת טלפון

משך זמן מועדף: □ 30 דקות □ 45 דקות □ שעה □ יותר אם נדרש

האם תרצו שהילד/ה יהיה/תהיה חלק מהשיחה? □ כן, כל השיחה □ כן, חלק מהשיחה □ לא, רק ההורים

תודה רבה על הזמן והמחשבה! התשובות שלכם יעזרו לנו להכין שיחה מועילת ומותאמת עבורכם.

שם ההורה הממלא: _________________ חתימה: _____________ תאריך: //______

אנא שלחו את השאלון המלא ל: [אימייל] או וואטסאפ: [מספר] לפחות יומיים לפני הפגישה
`,
    fileName: 'שאלון_הכנה_למנטוריות.docx' // Changed to .docx
  },
  {
    id: 'form3',
    title: 'דיווח מנטור למשפחה',
    content: `דיווח מנטור למשפחה
עמותת תלגלות את האור
שם הילד/ה: _________________ תאריך הדיווח: //______

שם המנטור: _________________ תקופת הדיווח: _________________

משפחה יקרה,

אנו שמחים לחלוק עמכם את ההתפתחות והעשיה של ילדכם/ילדתכם היקר/ה בעמותה. דיווח זה נכתב במטרה לשתף ולשמור על קשר הדוק ביננו.

התקדמות בתחום האמנותי
התחום הראשי: ________________________
מה הילד/ה למד/ה השבוע/חודש:

כישורים חדשים שרכש/ה: □ שיפור בביטחון עצמי בהופעה □ פיתוח יכולות טכניות □ יצירתיות מוגברת □ שיתוף פעולה טוב יותר עם הקבוצה □ אחר: ________________________________________________

הישגים מיוחדים:

התפתחות אישית וחברתית
יחסים חברתיים:
כיצד הילד/ה מתנהג/ת בקבוצה: □ מוביל/ה ויוזם/ת □ משתתף/ת בפעילות □ זקוק/ה לעידוד □ מתבודד/ת לפעמים

חברויות שנוצרו:

ביטחון עצמי:
שינויים שהבחנו בהם: □ יותר פתוח/ה לנסות דברים חדשים □ מביע/ה דעות וחוות דעת □ פחות מתבייש/ת להופיע מול אחרים □ מראה יותר גאווה בעבודתו/ה □ אחר: ________________________________________________

אתגרים וקשיים
תחומים שדורשים תשומת לב:

האופן שבו אנו מתמודדים עם האתגרים:

איך תוכלו לעזור בבית: • _______________________________________________________________ • _______________________________________________________________ • _______________________________________________________________

המלצות למשפחה
פעילויות לעידוד בבית:
□ האזנה למוזיקה מגוונת יחד □ צפייה בהצגות או סרטים □ יצירה משותפת (ציור, כתיבה, וכו') □ עידוד להופיע בפני המשפחה □ שיחות על חוויות מהעמותה □ אחר: ________________________________________________

דברים חשובים לזכור:
עידוד חיובי: _______________________________________________ תמיכה רגשית: ______________________________________________ סבלנות עם התהליך: _________________________________________

תוכניות לתקופה הקרובה
יעדים לחודש הבא:

פעילויות מיוחדות מתוכננות: □ הכנה להופעה □ סדנת יצירה □ פרויקט קבוצתי □ תחרות/פסטיבל □ אחר: ________________________________________________

אירועים שכדאי שתדעו עליהם:

צרכים ובקשות
האם יש משהו שחשוב שנדע על הילד/ה? (שינויים בבית, אירועים מיוחדים, קשיים חדשים וכו')

האם יש לכם שאלות או בקשות אלינו?

האם תרצו לקבוע פגישה אישית? □ כן □ לא

רגע של גאווה 🌟
הרגע הכי יפה השבוע/חודש עם הילד/ה שלכם:

מה הילד/ה אמר/ה שגרם לנו להתרגש:

פרטי קשר למעקב
דרכים ליצירת קשר:

טלפון: _________________ (בין השעות _____ - _____)
וואטסאפ: _________________
אימייל: _________________
זמינות לשיחות: □ בתיאום מראש □ חירום בלבד □ בכל עת

תודה לכם על השותפות והתמיכה! יחד אנו עוזרים לילדכם/ילדתכם לפרוח ולגלות את הכישרונות הייחודיים שלו/ה.

בברכה והערכה,

_________________ - מנטור מקצועי
עמותת תלגלות את האור

חתימה: _____________ תאריך: //______

דיווח זה נכתב בידידות ובכבוד רב למשפחתכם ולילדכם/ילדתכם היקר/ה
`,
    fileName: 'דיווח_מנטור_למשפחה.docx' // Changed to .docx
  },
];

function FormsPage() {
  const [currentFormId, setCurrentFormId] = useState(formsData[0].id);
  const currentForm = formsData.find(form => form.id === currentFormId);
  // Removed useRef import and usage, as it's not needed for docx simple text generation


  const handleDownload = async () => {
    if (currentForm) {
      // Create a new Document (representing the DOCX file)
      const doc = new Document({
        sections: [
          {
            properties: {
              // This part of docx library needs to be more specific for RTL
              // Example of setting section properties, including bidi:
              // For full RTL support, you might need to explore more advanced docx properties
              // or ensure your Word program defaults to RTL.
              // For basic text, rightToLeft on TextRun and AlignmentType.RIGHT on Paragraph are key.
            },
            children: currentForm.content.split('\n').map(line =>
              new Paragraph({
                children: [
                  new TextRun({
                    text: line,
                    // Specify font for Hebrew if needed, e.g., "David" or "Arial"
                    // font: "Arial", // Ensure this font is available on the user's system
                    rightToLeft: true, // Crucial for RTL text
                  }),
                ],
                alignment: AlignmentType.RIGHT, // Align paragraph to the right
              })
            ),
          },
        ],
      });

      // Generate the DOCX blob
      const blob = await Packer.toBlob(doc);
      saveAs(blob, currentForm.fileName);
    }
  };

  return (
    <DashboardLayout>
      <div
        className="min-h-screen py-12 px-4 sm:px-6 lg:px-8 relative w-full max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden p-8"
        dir="rtl"
      >
          <div className="text-center mb-8">
            <div className="flex items-center justify-center gap-3 mb-2">
              <FileText size={32} className="text-purple-600" />
              <h2 className="text-3xl font-extrabold text-gray-900">טפסים ודוחות להורדה</h2>
            </div>
            <p className="mt-2 text-sm text-gray-700">כאן תוכלו לצפות ולהוריד טפסים שונים הקשורים לפעילות העמותה.</p>
          </div>

          <div className="mb-8 flex flex-wrap justify-center gap-4">
            {formsData.map((form) => (
              <button
                key={form.id}
                onClick={() => setCurrentFormId(form.id)}
                className={`flex items-center gap-2 px-6 py-3 rounded-full text-sm font-semibold transition-all duration-300 ease-in-out
                  ${currentFormId === form.id
                    ? 'bg-purple-600 text-white shadow-md hover:bg-purple-700'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-900'
                  }`}
              >
                <FileText size={18} />
                {form.title}
              </button>
            ))}
          </div>

          {currentForm ? (
            <div className="border border-gray-200 rounded-lg p-6 bg-gray-50 shadow-inner">
              <div className="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                <h3 className="text-2xl font-bold text-gray-800">{currentForm.title}</h3>
                <button
                  onClick={handleDownload}
                  className="flex items-center gap-2 px-5 py-2 bg-indigo-500 text-white rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-300"
                >
                  <Download size={20} />
                  הורד מסמך
                </button>
              </div>

              <div
                // Removed ref={contentRef} as it's not needed for docx simple text generation
                className="prose prose-sm max-w-none text-gray-800 leading-relaxed whitespace-pre-wrap"
                style={{ overflowWrap: 'break-word', wordBreak: 'break-word' }}
              >
                {currentForm.content}
              </div>
            </div>
          ) : (
            <div className="text-center py-12 text-gray-600">
              <FileText size={48} className="mx-auto mb-4 text-gray-400" />
              <p className="text-xl font-medium">אנא בחר טופס לצפייה</p>
            </div>
          )}
      </div>
    </DashboardLayout>
  );
}

export default FormsPage;
